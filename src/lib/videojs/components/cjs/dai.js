"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js")),defaults={fallback:"",assetKey:"",source_id:"",video_id:"",liveApiKey:"",apiKey:"",debug:!1},onPlayerReady=(e,a)=>{var i,t=e.$(".vjs-tech"),d=!1,r=(e.el(),new Array),o=!1;videojs.options.autoplay&&(o=!0);t.getAttribute("autoplay")&&(o=!0);l();""!=a.assetKey?n():""!=a.source_id&&""!=a.video_id&&s();function n(){d=!0;var e=new google.ima.dai.api.LiveStreamRequest;e.assetKey=a.assetKey;e.apiKey=a.liveApiKey||"";i.requestStream(e)}function s(){d=!1;var e=new google.ima.dai.api.VODStreamRequest;e.contentSourceId=a.source_id;e.videoId=a.video_id;e.apiKey=a.apiKey||"";i.requestStream(e)}e.dai.requestVODStream=function(a){d=!1;i.reset();e.reset();videojs.dom.removeClass(e.el_,"vjs-dai");videojs.dom.removeClass(e.el_,"vjs-has-started");videojs.dom.removeClass(e.el_,"vjs-playing");videojs.dom.removeClass(e.bigPlayButton.el_,"vjs-no-pointer");l();var t=new google.ima.dai.api.VODStreamRequest;t.contentSourceId=a.source_id;t.videoId=a.video_id;t.apiKey=a.apiKey||"";i.requestStream(t)};e.dai.requestLivetream=function(a){d=!0;i.reset();e.reset();videojs.dom.removeClass(e.el_,"vjs-dai");videojs.dom.removeClass(e.el_,"vjs-has-started");videojs.dom.removeClass(e.el_,"vjs-playing");videojs.dom.removeClass(e.bigPlayButton.el_,"vjs-no-pointer");var t=new google.ima.dai.api.LiveStreamRequest;t.assetKey=a.assetKey;t.apiKey=a.apiKey||"";i.requestStream(t)};function l(){(i=i=new google.ima.dai.api.StreamManager(t)).addEventListener(google.ima.dai.api.StreamEvent.Type.LOADED,y,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.ERROR,c,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,f,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,E,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,S,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.STARTED,j,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,v,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.MIDPOINT,u,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,g,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.COMPLETE,m,!1);i.addEventListener(google.ima.dai.api.StreamEvent.Type.CLICK,p,!1)}function v(a){e.trigger("dai",{ad:r,type:"firstQuartile"})}function u(a){e.trigger("dai",{ad:r,type:"midpoint"})}function g(a){e.trigger("dai",{ad:r,type:"thirdQuartile"})}function m(a){e.trigger("dai",{ad:r,type:"complete"})}function p(a){e.trigger("dai",{ad:r,type:"adClick"})}function y(t){e.textTracks().addEventListener("addtrack",function(e){var t=e.track;"metadata"===t.kind&&t.addEventListener("cuechange",function(e){a.debug&&console.log(t.activeCues[0]);var d=t.activeCues[0];if(d&&d.value.data){var r={};r[d.value.key]=d.value.data;r.duration=1/0;i.onTimedMetadata(r)}},!1)},!1);e.src(t.getStreamData().url);o&&e.play()}function c(i){""!=a.fallback&&e.src(a.fallback)}function f(a){if(1!=d){var i=a.getStreamData().adProgressData,t=i.adPosition,r=i.totalAds,o=i.currentTime,n=i.duration,s=Math.floor(n-o),l=e.controlBar.el_.querySelector(".vjs-vast-label");l.innerHTML=1==r?"This Ad will end in "+s+"s":"Ad ("+t+" of "+r+") "+s+"s"}}function E(e){_(!0)}function S(e){r="undefined";_(!1)}function j(a){var i=a.getAd();(r=new Array).id=i.getAdId();r.title=i.getTitle();r.duration=i.getDuration();r.url=i.g.g.u;e.trigger("dai",{ad:r,type:"started"})}function _(a){var i=e.controlBar.el_.querySelector(".vjs-vast-label");if(a){videojs.dom.addClass(e.el_,"vjs-dai");d&&(i.innerHTML="Ad Playing")}else{videojs.dom.removeClass(e.el_,"vjs-dai");e.adPlaying=!1}}},version="1.0",registerPlugin=videojs.registerPlugin||videojs.plugin,dai=function(e){this.ready(()=>{onPlayerReady(this,videojs.mergeOptions(defaults,e))})};registerPlugin("dai",dai);dai.VERSION=version;module.exports=dai;