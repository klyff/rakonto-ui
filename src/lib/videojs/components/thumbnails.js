import videojs from"video.js";const defaults={width:160,height:90,basePath:"",src:""};var thumbTrack,tdiv,istrack=!1;const registerPlugin=videojs.registerPlugin||videojs.plugin,onPlayerReady=(e,t)=>{function r(e){var t,r,s;if(-1===(r=e.indexOf("#")))return{src:e,w:0,h:0,x:0,y:0};t=e.substring(0,r);if("xywh="!==(s=e.substring(r+1)).substring(0,5))return{src:defaults.basePath+t,w:0,h:0,x:0,y:0};var i=s.substring(5).split(",");return{src:defaults.basePath+t,w:parseInt(i[2]),h:parseInt(i[3]),x:parseInt(i[0]),y:parseInt(i[1])}}defaults.basePath="";""!==t.basePath&&(defaults.basePath=t.basePath);if(t.width&&t.height){defaults.width=t.width;defaults.height=t.height}var s=t;videojs.browser.TOUCH_ENABLED||e.on("medialoaded",function(t){e.sprite=!1;var i,a=e.textTracks().length;if(0!==a){l=0;for(;l<a;){if("metadata"===e.textTracks()[l].kind&&e.textTracks()[l].src){thumbTrack=e.textTracks()[l];istrack=!0;if(null===thumbTrack.cues)return;var d=thumbTrack&&thumbTrack.cues.length;thumbTrack.mode="hidden";break}l++}if(!0===istrack){if(!((d=thumbTrack&&thumbTrack.cues.length)<1)){for(var l=0;l<d;){r(thumbTrack.cues[l].text);l++}var o=e.controlBar.progressControl,h=(e.el_.querySelector(".vjs-progress-holder"),e.el_.querySelector(".vjs-thumb-tooltip"));null!==h&&h.parentNode.removeChild(h);var n=e.el_.querySelector(".vjs-thumb-image");null!==n&&n.parentNode.removeChild(n);var u=e.el_.querySelector(".vjs-thumbnail-holder");null!==u&&u.parentNode.removeChild(u);var v=e.el_.querySelector(".vjs-thumb-poster");null!==v&&v.parentNode.removeChild(v);(tdiv=document.createElement("div")).className="vjs-thumbnail-holder";var c=document.createElement("div");c.className="vjs-thumb-tooltip";var m=document.createElement("img");tdiv.appendChild(m);m.className="vjs-thumb-image";tdiv.appendChild(c);o.el().appendChild(tdiv);if(e.shadowSlide){var f=document.createElement("div");f.className="vjs-thumb-poster";var p=document.createElement("canvas");f.appendChild(p);e.el_.insertBefore(f,e.el_.querySelector(".vjs-poster"))}e.duration();e.on("durationchange",function(t){e.duration()});e.on("loadedmetadata",function(t){e.duration()});var y=this.el_.querySelector(".vjs-play-progress").querySelector(".vjs-time-tooltip");videojs.dom.addClass(y,"vjs-abs-hidden");var b=o.el().querySelector(".vjs-mouse-display");b.style.opacity=0;o.on("mousemove",g);e.on("progressdown",g);e.on("progressup",w);o.on("mouseout",j)}}else tdiv&&videojs.dom.addClass("tdiv","vjs-hidden")}else tdiv&&videojs.dom.addClass("tdiv","vjs-hidden");function g(t){var a=e.duration(),d=this.el_.querySelector(".vjs-mouse-display"),h=Number(d.style.left.replace(/px$/,"")),n=h/o.el().querySelector(".vjs-progress-holder").offsetWidth*a,u=b.querySelector(".vjs-time-tooltip");c.innerHTML=u.innerHTML;var v=thumbTrack&&thumbTrack.cues.length;l=0;for(var y=!1;l<v;){var g=thumbTrack.cues[l];if(g.startTime<=n&&g.endTime>=n){y=!0;i=r(g.text);break}l++}if(!0===y){tdiv.classList.remove("vjs-thumb-hidden");i.src&&m.src!==i.src&&(m.src=i.src);if(0===i.w){i.w=s.width;m.style.width=i.w+"px"}if(0===i.h){i.h=s.height;m.style.height=i.h+"px"}if(tdiv.style.width!==i.w||tdiv.style.height!==i.h){tdiv.style.width=i.w+"px";tdiv.style.height=i.h+"px"}m.style.left=-i.x+"px";m.style.top=-i.y+"px";var w=i.w,j=w/2,x=o.el().offsetWidth,k=e.el_.querySelector(".vjs-progress-holder").offsetLeft,T=j-k;h+j+k>x?h=x-w:h<T?h=0:h-=T;tdiv.style.left=h+"px";if(videojs.holderdown&&e.shadowSlide){var S=p.getContext("2d");p.width=e.el_.offsetWidth;p.height=e.el_.offsetHeight;f.style.width=p.width+"px";f.style.height=p.height+"px";S.clearRect(0,0,p.width,p.height);S.drawImage(m,i.x,i.y,i.w,i.h,0,0,p.width,p.height)}}else tdiv.classList.add("vjs-thumb-hidden")}function w(t){tdiv.style.left="-1000px";tdiv.style.removeProperty?tdiv.style.removeProperty("transform"):tdiv.style.removeAttribute("transform");videojs.holderdown=!1;if(e.shadowSlide){f.removeAttribute("style");p.width=0;p.height=0}document.removeEventListener("mouseup",w)}function j(e){if(videojs.holderdown){tdiv.style.transform="scale(1)";tdiv.style.webkitTransform="scale(1)"}else tdiv.style.left="-1000px"}})},thumbnails=function(e){this.ready(()=>{onPlayerReady(this,videojs.mergeOptions(defaults,e))})};registerPlugin("thumbnails",thumbnails);thumbnails.VERSION="1.1";export default thumbnails;